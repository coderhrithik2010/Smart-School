
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Principal Dashboard â€” Smart Classroom</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header class="topbar">
    <div class="brand">ðŸ“Š Principal Dashboard</div>
    <nav><a href="index.html">Home</a><a href="teacher.html">Teacher Panel</a></nav>
  </header>

  <main class="container">
    <h2>School overview</h2>

    <section class="card">
  <h3>Pick a classroom</h3>
  <select id="classPicker">
    <option value="">-- Select Class --</option>
  </select>
  <button id="loadClassBtn">Load Classroom Data</button>
</section>

    <section class="card">
      <h3>Class Marks Snapshot</h3>
      <canvas id="classChart"></canvas>
    </section>

    <section class="card">
      <h3>Recent Complaints (All Classes)</h3>
      <div id="allComplaints"></div>
    </section>
  </main>

  <footer class="footer">Realtime data from Firebase.</footer>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAmrwroeecIVIF1itF9MDPROquyXie-Rrc",
    authDomain: "smart-classroom-3d35a.firebaseapp.com",
    databaseURL: "https://smart-classroom-3d35a-default-rtdb.firebaseio.com",
    projectId: "smart-classroom-3d35a",
    storageBucket: "smart-classroom-3d35a.firebasestorage.app",
    messagingSenderId: "880063756991",
    appId: "1:880063756991:web:be8946acca3d771711240a",
    measurementId: "G-1V9K25838R"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const classPicker = document.getElementById("classPicker");
  const classSections = {};

  // Build dropdown
  for (let i = 1; i <= 10; i++) {
    const sections = (i === 8) ? ['A', 'B', 'C', 'D'] : ['A', 'B', 'C'];
    classSections[i] = sections;
  }
  Object.entries(classSections).forEach(([num, secs]) => {
    secs.forEach(sec => {
      const val = `class${num}${sec}`;
      const opt = document.createElement("option");
      opt.value = val;
      opt.textContent = `Class ${num} ${sec}`;
      classPicker.appendChild(opt);
    });
  });

  // Auto load chart when class changes
  let classChart;
  classPicker.addEventListener("change", () => {
    const cls = classPicker.value;
    if (!cls) return;
    loadClass(cls);
  });

  function loadClass(cls) {
    const marksRef = db.ref("classes/" + cls + "/marks");
    marksRef.on("value", snap => {
      const data = snap.val() || {};
      const names = Object.keys(data);
      const vals = names.map(n => data[n] || 0);
      const ctx = document.getElementById("classChart");
      if (classChart) classChart.destroy();
      classChart = new Chart(ctx, {
        type: "bar",
        data: {
          labels: names,
          datasets: [{ label: cls + " â€” Marks (%)", data: vals, backgroundColor: "#2563eb" }]
        },
        options: { scales: { y: { beginAtZero: true, max: 100 } } }
      });
    });
  }

  // === Complaints section (Resolved/Unresolved) ===
  const complaintsRef = db.ref("classes");
  complaintsRef.on("value", snap => {
    const data = snap.val() || {};
    const div = document.getElementById("allComplaints");
    let resolvedHTML = `
      <h3>Resolved Complaints</h3>
      <table border="1" style="width:100%;border-collapse:collapse;">
        <thead>
          <tr style="background:#16a34a;color:white;">
            <th>Class</th><th>Teacher</th><th>Complaint</th><th>Time</th><th>Status</th><th>Action</th>
          </tr>
        </thead><tbody id="resolvedBody"></tbody>
      </table>`;
    let unresolvedHTML = `
      <h3>Unresolved Complaints</h3>
      <table border="1" style="width:100%;border-collapse:collapse;">
        <thead>
          <tr style="background:#ef4444;color:white;">
            <th>Class</th><th>Teacher</th><th>Complaint</th><th>Time</th><th>Status</th><th>Action</th>
          </tr>
        </thead><tbody id="unresolvedBody"></tbody>
      </table>`;
    div.innerHTML = unresolvedHTML + "<br>" + resolvedHTML;

    const resolvedBody = document.getElementById("resolvedBody");
    const unresolvedBody = document.getElementById("unresolvedBody");

    Object.keys(data).forEach(cls => {
      const cobj = data[cls].complaints || {};
      Object.entries(cobj).forEach(([cid, c]) => {
        const tr = document.createElement("tr");
        const status = c.status || "Unresolved";
        tr.innerHTML = `
          <td>${cls}</td>
          <td>${c.teacher}</td>
          <td>${c.text}</td>
          <td><i style="color:#6b7280">${c.time}</i></td>
          <td>${status}</td>
          <td>
            <button style="background:#16a34a" onclick="markResolved('${cls}','${cid}')">âœ” Resolve</button>
            <button style="background:#facc15;color:#000" onclick="markUnresolved('${cls}','${cid}')">â†º Unresolve</button>
            <button style="background:#ef4444" onclick="deleteComplaint('${cls}','${cid}')">ðŸ—‘ Delete</button>
          </td>`;
        if (status === "Resolved") resolvedBody.appendChild(tr);
        else unresolvedBody.appendChild(tr);
      });
    });
  });

  function markResolved(cls, id) {
    db.ref("classes/" + cls + "/complaints/" + id).update({ status: "Resolved" });
  }
  function markUnresolved(cls, id) {
    db.ref("classes/" + cls + "/complaints/" + id).update({ status: "Unresolved" });
  }
  function deleteComplaint(cls, id) {
    if (confirm("Delete this complaint?")) {
      db.ref("classes/" + cls + "/complaints/" + id).remove();
    }
  }
</script>


</body>
</html>
